/* é˜…è¯»è¿›åº¦ start */
document.addEventListener("pjax:complete", function () {
  window.onscroll = percent;
});
document.addEventListener("DOMContentLoaded", function () {
  window.onscroll = percent;
});
// é¡µé¢ç™¾åˆ†æ¯”
function percent() {
  // å…ˆè®©èœå•æ æ¶ˆå¤±
  try {
    rmf.showRightMenu(false);
    $(".rmMask").attr("style", "display: none");
  } catch (err) {}

  let a = document.documentElement.scrollTop, // å·å»é«˜åº¦
    b =
      Math.max(
        document.body.scrollHeight,
        document.documentElement.scrollHeight,
        document.body.offsetHeight,
        document.documentElement.offsetHeight,
        document.body.clientHeight,
        document.documentElement.clientHeight,
      ) - document.documentElement.clientHeight, // æ•´ä¸ªç½‘é¡µé«˜åº¦ å‡å» å¯è§†é«˜åº¦
    result = Math.round((a / b) * 100), // è®¡ç®—ç™¾åˆ†æ¯”
    btn = document.querySelector("#go-up"); // è·å–æŒ‰é’®

  if (result < 95) {
    // å¦‚æœé˜…è¯»è¿›åº¦å°äº95% å°±æ˜¾ç¤ºç™¾åˆ†æ¯”
    btn.childNodes[0].style.display = "none";
    btn.childNodes[1].style.display = "block";
    btn.childNodes[1].innerHTML = result + "<span>%</span>";
  } else {
    // å¦‚æœå¤§äº95%å°±æ˜¾ç¤ºå›åˆ°é¡¶éƒ¨å›¾æ ‡
    btn.childNodes[1].style.display = "none";
    btn.childNodes[0].style.display = "block";
  }
}
/* é˜…è¯»è¿›åº¦ end */

//----------------------------------------------------------------

/* å¯¼èˆªæ æ˜¾ç¤ºæ ‡é¢˜ start */

document.addEventListener("pjax:complete", tonav);
document.addEventListener("DOMContentLoaded", tonav);
//å“åº”pjax
function tonav() {
  document
    .getElementById("name-container")
    .setAttribute("style", "display:none");
  var position = $(window).scrollTop();
  $(window).scroll(function () {
    var scroll = $(window).scrollTop();
    if (scroll > position) {
      document.getElementById("name-container").setAttribute("style", "");
      document
        .getElementsByClassName("menus_items")[1]
        .setAttribute("style", "display:none!important");
    } else {
      document
        .getElementsByClassName("menus_items")[1]
        .setAttribute("style", "");
      document
        .getElementById("name-container")
        .setAttribute("style", "display:none");
    }
    position = scroll;
  });
  //ä¿®å¤æ²¡æœ‰å¼„å³é”®èœå•çš„ç«¥é‹æ— æ³•å›é¡¶éƒ¨çš„é—®é¢˜
  document.getElementById("page-name").innerText =
    document.title.split(" | FomalhautğŸ¥")[0];
}

function scrollToTop() {
  document.getElementsByClassName("menus_items")[1].setAttribute("style", "");
  document
    .getElementById("name-container")
    .setAttribute("style", "display:none");
  btf.scrollToDest(0, 500);
}

/* å¾®åšçƒ­æœ start */
document.addEventListener("pjax:complete", getWeibo);
document.addEventListener("DOMContentLoaded", getWeibo);

function getWeibo() {
  fetch("")
    .then((data) => data.json())
    .then((data) => {
      // è¿™é‡Œè¦å†™ä¸Šä½ çš„API!!!
      let html =
        "<style>.weibo-new{background:#ff3852}.weibo-hot{background:#ff9406}.weibo-jyzy{background:#ffc000}.weibo-recommend{background:#00b7ee}.weibo-adrecommend{background:#febd22}.weibo-friend{background:#8fc21e}.weibo-boom{background:#bd0000}.weibo-topic{background:#ff6f49}.weibo-topic-ad{background:#4dadff}.weibo-boil{background:#f86400}#weibo-container{overflow-y:auto;-ms-overflow-style:none;scrollbar-width:none}#weibo-container::-webkit-scrollbar{display:none}.weibo-list-item{display:flex;flex-direction:row;justify-content:space-between;flex-wrap:nowrap}.weibo-title{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-right:auto}.weibo-num{float:right}.weibo-hotness{display:inline-block;padding:0 6px;transform:scale(.8) translateX(-3px);color:#fff;border-radius:8px}</style>";
      html += '<div class="weibo-list">';
      let hotness = {
        çˆ†: "weibo-boom",
        çƒ­: "weibo-hot",
        æ²¸: "weibo-boil",
        æ–°: "weibo-new",
        è: "weibo-recommend",
        éŸ³: "weibo-jyzy",
        å½±: "weibo-jyzy",
        å‰§: "weibo-jyzy",
        ç»¼: "weibo-jyzy",
      };
      for (let item of data) {
        html +=
          '<div class="weibo-list-item"><div class="weibo-hotness ' +
          hotness[item.hot || "è"] +
          '">' +
          (item.hot || "è") +
          "</div>" +
          '<span class="weibo-title"><a title="' +
          item.title +
          '"href="' +
          item.url +
          '" target="_blank" rel="external nofollow noreferrer" style="color:#a08ed5">' +
          item.title +
          "</a></span>" +
          '<div class="weibo-num"><span>' +
          item.num +
          "</span></div></div>";
      }
      html += "</div>";
      document.getElementById("weibo-container").innerHTML = html;
    })
    .catch(function (error) {
      console.log(error);
    });
}

/* å¾®åšçƒ­æœ end */

/* ç¦ç”¨f12ä¸æŒ‰é”®é˜²æŠ– start */
// é˜²æŠ–å…¨å±€è®¡æ—¶å™¨
let TT = null; //timeç”¨æ¥æ§åˆ¶äº‹ä»¶çš„è§¦å‘
// é˜²æŠ–å‡½æ•°:fn->é€»è¾‘ time->é˜²æŠ–æ—¶é—´
function debounce(fn, time) {
  if (TT !== null) clearTimeout(TT);
  TT = setTimeout(fn, time);
}

// å¤åˆ¶æé†’
document.addEventListener("copy", function () {
  debounce(function () {
    new Vue({
      data: function () {
        this.$notify({
          title: "å“å˜¿ï¼å¤åˆ¶æˆåŠŸğŸ¬",
          message: "è‹¥è¦è½¬è½½æœ€å¥½ä¿ç•™åŸæ–‡é“¾æ¥å“¦ï¼Œç»™ä½ ä¸€ä¸ªå¤§å¤§çš„èµï¼",
          position: "top-left",
          offset: 50,
          showClose: true,
          type: "success",
          duration: 5000,
        });
      },
    });
  }, 300);
});

// f12æé†’ä½†ä¸ç¦ç”¨
document.onkeydown = function (e) {
  if (
    123 == e.keyCode ||
    (e.ctrlKey &&
      e.shiftKey &&
      (74 === e.keyCode || 73 === e.keyCode || 67 === e.keyCode)) ||
    (e.ctrlKey && 85 === e.keyCode)
  ) {
    debounce(function () {
      new Vue({
        data: function () {
          this.$notify({
            title: "ä½ å·²è¢«å‘ç°ğŸ˜œ",
            message: "å°ä¼™å­ï¼Œæ‰’æºè®°ä½è¦éµå¾ªGPLåè®®ï¼",
            position: "top-left",
            offset: 50,
            showClose: true,
            type: "warning",
            duration: 5000,
          });
        },
      });
    }, 300);
  }
};
/* ç¦ç”¨f12ä¸æŒ‰é”®é˜²æŠ– end */

//----------------------------------------------------------------

/* é›ªèŠ±ç‰¹æ•ˆ start */
if (
  navigator.userAgent.match(
    /(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i,
  )
) {
  // ç§»åŠ¨ç«¯ä¸æ˜¾ç¤º
} else {
  // document.write('<canvas id="snow" style="position:fixed;top:0;left:0;width:100%;height:100%;z-index:-2;pointer-events:none"></canvas>');

  window &&
    (() => {
      let e = {
        flakeCount: 50, // é›ªèŠ±æ•°ç›®
        minDist: 150, // æœ€å°è·ç¦»
        color: "255, 255, 255", // é›ªèŠ±é¢œè‰²
        size: 1.5, // é›ªèŠ±å¤§å°
        speed: 0.5, // é›ªèŠ±é€Ÿåº¦
        opacity: 0.7, // é›ªèŠ±é€æ˜åº¦
        stepsize: 0.5, // æ­¥è·
      };
      const t =
        window.requestAnimationFrame ||
        window.mozRequestAnimationFrame ||
        window.webkitRequestAnimationFrame ||
        window.msRequestAnimationFrame ||
        function (e) {
          window.setTimeout(e, 1e3 / 60);
        };
      window.requestAnimationFrame = t;
      const i = document.getElementById("snow"),
        n = i.getContext("2d"),
        o = e.flakeCount;
      let a = -100,
        d = -100,
        s = [];
      ((i.width = window.innerWidth), (i.height = window.innerHeight));
      const h = () => {
          n.clearRect(0, 0, i.width, i.height);
          const r = e.minDist;
          for (let t = 0; t < o; t++) {
            let o = s[t];
            const h = a,
              w = d,
              m = o.x,
              c = o.y,
              p = Math.sqrt((h - m) * (h - m) + (w - c) * (w - c));
            if (p < r) {
              const e = (h - m) / p,
                t = (w - c) / p,
                i = r / (p * p) / 2;
              ((o.velX -= i * e), (o.velY -= i * t));
            } else
              ((o.velX *= 0.98),
                o.velY < o.speed &&
                  o.speed - o.velY > 0.01 &&
                  (o.velY += 0.01 * (o.speed - o.velY)),
                (o.velX += Math.cos((o.step += 0.05)) * o.stepSize));
            ((n.fillStyle = "rgba(" + e.color + ", " + o.opacity + ")"),
              (o.y += o.velY),
              (o.x += o.velX),
              (o.y >= i.height || o.y <= 0) && l(o),
              (o.x >= i.width || o.x <= 0) && l(o),
              n.beginPath(),
              n.arc(o.x, o.y, o.size, 0, 2 * Math.PI),
              n.fill());
          }
          t(h);
        },
        l = (e) => {
          ((e.x = Math.floor(Math.random() * i.width)),
            (e.y = 0),
            (e.size = 3 * Math.random() + 2),
            (e.speed = 1 * Math.random() + 0.5),
            (e.velY = e.speed),
            (e.velX = 0),
            (e.opacity = 0.5 * Math.random() + 0.3));
        };
      (document.addEventListener("mousemove", (e) => {
        ((a = e.clientX), (d = e.clientY));
      }),
        window.addEventListener("resize", () => {
          ((i.width = window.innerWidth), (i.height = window.innerHeight));
        }),
        (() => {
          for (let t = 0; t < o; t++) {
            const t = Math.floor(Math.random() * i.width),
              n = Math.floor(Math.random() * i.height),
              o = 3 * Math.random() + e.size,
              a = 1 * Math.random() + e.speed,
              d = 0.5 * Math.random() + e.opacity;
            s.push({
              speed: a,
              velX: 0,
              velY: a,
              x: t,
              y: n,
              size: o,
              stepSize: (Math.random() / 30) * e.stepsize,
              step: 0,
              angle: 180,
              opacity: d,
            });
          }
          h();
        })());
    })();
}

/* é›ªèŠ±ç‰¹æ•ˆ end */

//----------------------------------------------------------------

/* æ˜Ÿç©ºç‰¹æ•ˆ start */
function dark() {
  window.requestAnimationFrame =
    window.requestAnimationFrame ||
    window.mozRequestAnimationFrame ||
    window.webkitRequestAnimationFrame ||
    window.msRequestAnimationFrame;
  var n,
    e,
    i,
    h,
    t = 0.05,
    s = document.getElementById("universe"),
    o = !0,
    a = "180,184,240",
    r = "226,225,142",
    d = "226,225,224",
    c = [];

  function f() {
    ((n = window.innerWidth),
      (e = window.innerHeight),
      (i = 0.216 * n),
      s.setAttribute("width", n),
      s.setAttribute("height", e));
  }
  function u() {
    h.clearRect(0, 0, n, e);
    for (var t = c.length, i = 0; i < t; i++) {
      var s = c[i];
      (s.move(), s.fadeIn(), s.fadeOut(), s.draw());
    }
  }
  function y() {
    ((this.reset = function () {
      ((this.giant = m(3)),
        (this.comet = !this.giant && !o && m(10)),
        (this.x = l(0, n - 10)),
        (this.y = l(0, e)),
        (this.r = l(1.1, 2.6)),
        (this.dx = l(t, 6 * t) + (this.comet + 1 - 1) * t * l(50, 120) + 2 * t),
        (this.dy = -l(t, 6 * t) - (this.comet + 1 - 1) * t * l(50, 120)),
        (this.fadingOut = null),
        (this.fadingIn = !0),
        (this.opacity = 0),
        (this.opacityTresh = l(0.2, 1 - 0.4 * (this.comet + 1 - 1))),
        (this.do = l(5e-4, 0.002) + 0.001 * (this.comet + 1 - 1)));
    }),
      (this.fadeIn = function () {
        this.fadingIn &&
          ((this.fadingIn = !(this.opacity > this.opacityTresh)),
          (this.opacity += this.do));
      }),
      (this.fadeOut = function () {
        this.fadingOut &&
          ((this.fadingOut = !(this.opacity < 0)),
          (this.opacity -= this.do / 2),
          (this.x > n || this.y < 0) && ((this.fadingOut = !1), this.reset()));
      }),
      (this.draw = function () {
        if ((h.beginPath(), this.giant))
          ((h.fillStyle = "rgba(" + a + "," + this.opacity + ")"),
            h.arc(this.x, this.y, 2, 0, 2 * Math.PI, !1));
        else if (this.comet) {
          ((h.fillStyle = "rgba(" + d + "," + this.opacity + ")"),
            h.arc(this.x, this.y, 1.5, 0, 2 * Math.PI, !1));
          for (var t = 0; t < 30; t++)
            ((h.fillStyle =
              "rgba(" +
              d +
              "," +
              (this.opacity - (this.opacity / 20) * t) +
              ")"),
              h.rect(
                this.x - (this.dx / 4) * t,
                this.y - (this.dy / 4) * t - 2,
                2,
                2,
              ),
              h.fill());
        } else
          ((h.fillStyle = "rgba(" + r + "," + this.opacity + ")"),
            h.rect(this.x, this.y, this.r, this.r));
        (h.closePath(), h.fill());
      }),
      (this.move = function () {
        ((this.x += this.dx),
          (this.y += this.dy),
          !1 === this.fadingOut && this.reset(),
          (this.x > n - n / 4 || this.y < 0) && (this.fadingOut = !0));
      }),
      setTimeout(function () {
        o = !1;
      }, 50));
  }
  function m(t) {
    return Math.floor(1e3 * Math.random()) + 1 < 10 * t;
  }
  function l(t, i) {
    return Math.random() * (i - t) + t;
  }
  (f(),
    window.addEventListener("resize", f, !1),
    (function () {
      h = s.getContext("2d");
      for (var t = 0; t < i; t++) ((c[t] = new y()), c[t].reset());
      u();
    })(),
    (function t() {
      (document.getElementsByTagName("html")[0].getAttribute("data-theme") ==
        "dark" && u(),
        window.requestAnimationFrame(t));
    })());
}
dark();
/* æ˜Ÿç©ºç‰¹æ•ˆ end */

//----------------------------------------------------------------

/* è¡¨æƒ…æ”¾å¤§ start */
document.addEventListener("pjax:complete", function () {
  if (document.getElementById("post-comment")) owoBig();
});
document.addEventListener("DOMContentLoaded", function () {
  if (document.getElementById("post-comment")) owoBig();
});

// è¡¨æƒ…æ”¾å¤§
function owoBig() {
  let flag = 1, // è®¾ç½®èŠ‚æµé˜€
    owo_time = "", // è®¾ç½®è®¡æ—¶å™¨
    m = 3; // è®¾ç½®æ”¾å¤§å€æ•°
  // åˆ›å»ºç›’å­
  let div = document.createElement("div"),
    body = document.querySelector("body");
  // è®¾ç½®ID
  div.id = "owo-big";
  // æ’å…¥ç›’å­
  body.appendChild(div);

  // æ„é€ observer
  let observer = new MutationObserver((mutations) => {
    for (let i = 0; i < mutations.length; i++) {
      let dom = mutations[i].addedNodes,
        owo_body = "";
      if (dom.length == 2 && dom[1].className == "OwO-body") owo_body = dom[1];
      // å¦‚æœéœ€è¦åœ¨è¯„è®ºå†…å®¹ä¸­å¯ç”¨æ­¤åŠŸèƒ½è¯·è§£é™¤ä¸‹é¢çš„æ³¨é‡Š
      // else if (dom.length == 1 && dom[0].className == 'tk-comment') owo_body = dom[0];
      else continue;

      // ç¦ç”¨å³é”®ï¼ˆæ‰‹æœºç«¯é•¿æŒ‰ä¼šå‡ºç°å³é”®èœå•ï¼Œä¸ºäº†ä½“éªŒç»™ç¦ç”¨æ‰ï¼‰
      if (document.body.clientWidth <= 768)
        owo_body.addEventListener("contextmenu", (e) => e.preventDefault());
      // é¼ æ ‡ç§»å…¥
      owo_body.onmouseover = (e) => {
        if (flag && e.target.tagName == "IMG") {
          flag = 0;
          // ç§»å…¥300æ¯«ç§’åæ˜¾ç¤ºç›’å­
          owo_time = setTimeout(() => {
            let height = e.path[0].clientHeight * m, // ç›’å­é«˜
              width = e.path[0].clientWidth * m, // ç›’å­å®½
              left = e.x - e.offsetX - (width - e.path[0].clientWidth) / 2, // ç›’å­ä¸å±å¹•å·¦è¾¹è·ç¦»
              top = e.y - e.offsetY; // ç›’å­ä¸å±å¹•é¡¶éƒ¨è·ç¦»

            if (left + width > body.clientWidth)
              left -= left + width - body.clientWidth + 10; // å³è¾¹ç¼˜æ£€æµ‹ï¼Œé˜²æ­¢è¶…å‡ºå±å¹•
            if (left < 0) left = 10; // å·¦è¾¹ç¼˜æ£€æµ‹ï¼Œé˜²æ­¢è¶…å‡ºå±å¹•
            // è®¾ç½®ç›’å­æ ·å¼
            div.style.cssText = `display:flex; height:${height}px; width:${width}px; left:${left}px; top:${top}px;`;
            // åœ¨ç›’å­ä¸­æ’å…¥å›¾ç‰‡
            div.innerHTML = `<img src="${e.target.src}">`;
          }, 300);
        }
      };
      // é¼ æ ‡ç§»å‡ºéšè—ç›’å­
      owo_body.onmouseout = () => {
        ((div.style.display = "none"), (flag = 1), clearTimeout(owo_time));
      };
    }
  });
  observer.observe(document.getElementById("post-comment"), {
    subtree: true,
    childList: true,
  });
}
/* è¡¨æƒ…æ”¾å¤§ end */

//----------------------------------------------------------------

/* éšä¾¿é€›é€› start */
// éšä¾¿é€›é€›
// å‘ç°æœ‰æ—¶ä¼šå’Œå½“å‰é¡µé¢é‡å¤ï¼ŒåŠ ä¸€ä¸ªåˆ¤æ–­
function randomPost() {
  fetch("/baidusitemap.xml")
    .then((res) => res.text())
    .then((str) => new window.DOMParser().parseFromString(str, "text/xml"))
    .then((data) => {
      let ls = data.querySelectorAll("url loc");
      while (true) {
        let url = ls[Math.floor(Math.random() * ls.length)].innerHTML;
        if (location.href == url) continue;
        location.href = url;
        return;
      }
    });
}
/* éšä¾¿é€›é€› end */

/* å³é”®èœå• start */
function setMask() {
  //è®¾ç½®é®ç½©
  if (document.getElementsByClassName("rmMask")[0] != undefined)
    return document.getElementsByClassName("rmMask")[0];
  mask = document.createElement("div");
  mask.className = "rmMask";
  mask.style.width = window.innerWidth + "px";
  mask.style.height = window.innerHeight + "px";
  mask.style.background = "#fff";
  mask.style.opacity = ".0";
  mask.style.position = "fixed";
  mask.style.top = "0";
  mask.style.left = "0";
  mask.style.zIndex = 998;
  document.body.appendChild(mask);
  document.getElementById("rightMenu").style.zIndex = 19198;
  return mask;
}

function insertAtCursor(myField, myValue) {
  //IE æµè§ˆå™¨
  if (document.selection) {
    myField.focus();
    sel = document.selection.createRange();
    sel.text = myValue;
    sel.select();
  }

  //FireFoxã€Chromeç­‰
  else if (myField.selectionStart || myField.selectionStart == "0") {
    var startPos = myField.selectionStart;
    var endPos = myField.selectionEnd;

    // ä¿å­˜æ»šåŠ¨æ¡
    var restoreTop = myField.scrollTop;
    myField.value =
      myField.value.substring(0, startPos) +
      myValue +
      myField.value.substring(endPos, myField.value.length);

    if (restoreTop > 0) {
      myField.scrollTop = restoreTop;
    }

    myField.focus();
    myField.selectionStart = startPos + myValue.length;
    myField.selectionEnd = startPos + myValue.length;
  } else {
    myField.value += myValue;
    myField.focus();
  }
}

let rmf = {};
rmf.showRightMenu = function (isTrue, x = 0, y = 0) {
  let $rightMenu = $("#rightMenu");
  $rightMenu.css("top", x + "px").css("left", y + "px");

  if (isTrue) {
    $rightMenu.show();
  } else {
    $rightMenu.hide();
  }
};

rmf.copyWordsLink = function () {
  let url = window.location.href;
  let txa = document.createElement("textarea");
  txa.value = url;
  document.body.appendChild(txa);
  txa.select();
  document.execCommand("Copy");
  document.body.removeChild(txa);
};
rmf.switchReadMode = function () {
  const $body = document.body;
  $body.classList.add("read-mode");
  const newEle = document.createElement("button");
  newEle.type = "button";
  newEle.className = "fas fa-sign-out-alt exit-readmode";
  $body.appendChild(newEle);

  function clickFn() {
    $body.classList.remove("read-mode");
    newEle.remove();
    newEle.removeEventListener("click", clickFn);
  }

  newEle.addEventListener("click", clickFn);
};

//å¤åˆ¶é€‰ä¸­æ–‡å­—
rmf.copySelect = function () {
  document.execCommand("Copy", false, null);
};

//å›åˆ°é¡¶éƒ¨
rmf.scrollToTop = function () {
  document.getElementsByClassName("menus_items")[1].setAttribute("style", "");
  document
    .getElementById("name-container")
    .setAttribute("style", "display:none");
  btf.scrollToDest(0, 500);
};

document.body.addEventListener("touchmove", function () {}, { passive: false });

function popupMenu() {
  window.oncontextmenu = function (event) {
    // if (event.ctrlKey) return true;

    // å½“å…³æ‰è‡ªå®šä¹‰å³é”®æ—¶å€™ç›´æ¥è¿”å›
    if (mouseMode == "off") return true;

    $(".rightMenu-group.hide").hide();
    if (document.getSelection().toString()) {
      $("#menu-text").show();
    }
    $("#menu-text #copy").hide();
    $("#menu-text #reply").hide();
    //å¦‚æœæœ‰æ–‡å­—é€‰ä¸­ï¼Œåˆ™æ˜¾ç¤º æ–‡å­—é€‰ä¸­ç›¸å…³çš„èœå•é¡¹
    if (document.getSelection().toString()) {
      $("#menu-text #copy").show();
    }
    const currentPath = window.location.pathname;
    if (
      document.getSelection().toString() &&
      currentPath.startsWith("/posts/")
    ) {
      // å¦‚æœé¡µé¢ä¸­æ²¡æœ‰å¼¹çª—å…ƒç´ ï¼Œåˆ™æ˜¾ç¤ºæŒ‰é’®å¹¶è°ƒç”¨å‡½æ•°æ˜¾ç¤ºå¼¹çª—
      if (!document.getElementById("popup")) {
        $("#menu-text #reply").show();
      }
    }
    if (document.getElementById("post")) {
      $("#menu-post").show();
    } else {
      if (document.getElementById("page")) {
        $("#menu-post").show();
      }
    }
    var el = window.document.body;
    el = event.target;
    var a =
      /^(?:http(s)?:\/\/)?[\w.-]+(?:\.[\w\.-]+)+[\w\-\._~:/?#[\]@!\$&'\*\+,;=.]+$/;
    if (a.test(window.getSelection().toString()) && el.tagName != "A") {
      $("#menu-too").show();
    }
    if (el.tagName == "A") {
      $("#menu-to").show();
      rmf.open = function () {
        if (
          (el.href.indexOf("http://") == -1 &&
            el.href.indexOf("https://") == -1) ||
          el.href.indexOf("yisous.xyz") != -1
        ) {
          pjax.loadUrl(el.href);
        } else {
          location.href = el.href;
        }
      };
      rmf.openWithNewTab = function () {
        window.open(el.href);
        // window.location.reload();
      };
      rmf.copyLink = function () {
        let url = el.href;
        let txa = document.createElement("textarea");
        txa.value = url;
        document.body.appendChild(txa);
        txa.select();
        document.execCommand("Copy");
        document.body.removeChild(txa);
      };
    } else if (el.tagName == "IMG") {
      $("#menu-img").show();
      rmf.openWithNewTab = function () {
        window.open(el.src);
        // window.location.reload();
      };
      rmf.click = function () {
        el.click();
      };
      rmf.copyLink = function () {
        let url = el.src;
        let txa = document.createElement("textarea");
        txa.value = url;
        document.body.appendChild(txa);
        txa.select();
        document.execCommand("Copy");
        document.body.removeChild(txa);
      };
      rmf.saveAs = function () {
        var a = document.createElement("a");
        var url = el.src;
        var filename = url.split("/")[-1];
        a.href = url;
        a.download = filename;
        a.click();
        window.URL.revokeObjectURL(url);
      };
    } else if (el.tagName == "TEXTAREA" || el.tagName == "INPUT") {
      $("#menu-paste").show();
      rmf.paste = function () {
        navigator.permissions
          .query({
            name: "clipboard-read",
          })
          .then((result) => {
            if (result.state == "granted" || result.state == "prompt") {
              //è¯»å–å‰ªè´´æ¿
              navigator.clipboard.readText().then((text) => {
                console.log(text);
                insertAtCursor(el, text);
              });
            } else {
              Snackbar.show({
                text: "è¯·å…è®¸è¯»å–å‰ªè´´æ¿ï¼",
                pos: "top-center",
                showAction: false,
              });
            }
          });
      };
    }
    let pageX = event.clientX + 10;
    let pageY = event.clientY;
    let rmWidth = $("#rightMenu").width();
    let rmHeight = $("#rightMenu").height();
    if (pageX + rmWidth > window.innerWidth) {
      pageX -= rmWidth + 10;
    }
    if (pageY + rmHeight > window.innerHeight) {
      pageY -= pageY + rmHeight - window.innerHeight;
    }
    mask = setMask();
    // æ»šåŠ¨æ¶ˆå¤±çš„ä»£ç å’Œé˜…è¯»è¿›åº¦æœ‰å†²çªï¼Œå› æ­¤æ”¾åˆ°readPercent.jsé‡Œé¢äº†
    $(".rightMenu-item").click(() => {
      $(".rmMask").attr("style", "display: none");
    });
    $(window).resize(() => {
      rmf.showRightMenu(false);
      $(".rmMask").attr("style", "display: none");
    });
    mask.onclick = () => {
      $(".rmMask").attr("style", "display: none");
    };
    rmf.showRightMenu(true, pageY, pageX);
    $(".rmMask").attr("style", "display: flex");
    return false;
  };

  window.addEventListener("click", function () {
    rmf.showRightMenu(false);
  });
}
if (
  !navigator.userAgent.match(
    /(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i,
  )
) {
  popupMenu();
}
const box = document.documentElement;

function addLongtabListener(target, callback) {
  let timer = 0; // åˆå§‹åŒ–timer

  target.ontouchstart = () => {
    timer = 0; // é‡ç½®timer
    timer = setTimeout(() => {
      callback();
      timer = 0;
    }, 380); // è¶…æ—¶å™¨èƒ½æˆåŠŸæ‰§è¡Œï¼Œè¯´æ˜æ˜¯é•¿æŒ‰
  };

  target.ontouchmove = () => {
    clearTimeout(timer); // å¦‚æœæ¥åˆ°è¿™é‡Œï¼Œè¯´æ˜æ˜¯æ»‘åŠ¨
    timer = 0;
  };

  target.ontouchend = () => {
    // åˆ°è¿™é‡Œå¦‚æœtimeræœ‰å€¼ï¼Œè¯´æ˜æ­¤è§¦æ‘¸æ—¶é—´ä¸è¶³380msï¼Œæ˜¯ç‚¹å‡»
    if (timer) {
      clearTimeout(timer);
    }
  };
}

addLongtabListener(box, popupMenu);

// å…¨å±
rmf.fullScreen = function () {
  if (document.fullscreenElement) document.exitFullscreen();
  else document.documentElement.requestFullscreen();
};

// å³é”®å¼€å…³
if (localStorage.getItem("mouse") == undefined) {
  localStorage.setItem("mouse", "on");
}
var mouseMode = localStorage.getItem("mouse");
function changeMouseMode() {
  if (localStorage.getItem("mouse") == "on") {
    mouseMode = "off";
    localStorage.setItem("mouse", "off");
    debounce(function () {
      new Vue({
        data: function () {
          this.$notify({
            title: "åˆ‡æ¢å³é”®æ¨¡å¼æˆåŠŸğŸ”",
            message: "å½“å‰é¼ æ ‡å³é”®å·²æ¢å¤ä¸ºç³»ç»Ÿé»˜è®¤ï¼",
            position: "top-left",
            offset: 50,
            showClose: true,
            type: "success",
            duration: 5000,
          });
        },
      });
    }, 300);
  } else {
    mouseMode = "on";
    localStorage.setItem("mouse", "on");
    debounce(function () {
      new Vue({
        data: function () {
          this.$notify({
            title: "åˆ‡æ¢å³é”®æ¨¡å¼æˆåŠŸğŸ”",
            message: "å½“å‰é¼ æ ‡å³é”®å·²æ›´æ¢ä¸ºç½‘ç«™æŒ‡å®šæ ·å¼ï¼",
            position: "top-left",
            offset: 50,
            showClose: true,
            type: "success",
            duration: 5000,
          });
        },
      });
    }, 300);
  }
}
/* å³é”®èœå• end */

//----------------------------------------------------------------

/* æ§åˆ¶å°è¾“å‡ºå­—ç¬¦ç”» start */
var now1 = new Date();

function createtime1() {
  var grt = new Date("19/09/2024 00:00:00"); //æ­¤å¤„ä¿®æ”¹ä½ çš„å»ºç«™æ—¶é—´æˆ–è€…ç½‘ç«™ä¸Šçº¿æ—¶é—´
  now1.setTime(now1.getTime() + 250);
  var days = (now1 - grt) / 1000 / 60 / 60 / 24;
  var dnum = Math.floor(days);

  var ascll = [
    `æ¬¢è¿æ¥åˆ°èè‰ç‹ã®æ•…ä¹¡ğŸŒ¸`,
    `Welcome to LoliKing's HometownğŸŒ¹`,
    ` 

    â–ˆâ–ˆâ•—      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—     â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— 
    â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â• 
    â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ–ˆâ•—
    â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘
    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•
    â•šâ•â•â•â•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•â•â•šâ•â•â•šâ•â•  â•šâ•â•â•šâ•â•â•šâ•â•  â•šâ•â•â•â• â•šâ•â•â•â•â•â•                                                             
                                            
`,
  ];

  setTimeout(
    console.log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#39c5bb",
      "",
      "color:#39c5bb",
      "color:#39c5bb",
      "",
      "color:#39c5bb",
      "",
    ),
  );
}

createtime1();

// é‡å†™consoleæ–¹æ³•
console.log = function () {};
console.error = function () {};
console.warn = function () {};

/* æ§åˆ¶å°è¾“å‡ºå­—ç¬¦ç”» end */

//----------------------------------------------------------------

/* å¤œé—´æ¨¡å¼åˆ‡æ¢åŠ¨ç”» start */
function switchNightMode() {
  (document
    .querySelector("body")
    .insertAdjacentHTML(
      "beforeend",
      '<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"><div id="sun"></div><div id="moon"></div></div></div>',
    ),
    setTimeout(function () {
      (document.querySelector("body").classList.contains("DarkMode")
        ? (document.querySelector("body").classList.remove("DarkMode"),
          localStorage.setItem("isDark", "0"),
          document
            .getElementById("modeicon")
            .setAttribute("xlink:href", "#icon-moon"))
        : (document.querySelector("body").classList.add("DarkMode"),
          localStorage.setItem("isDark", "1"),
          document
            .getElementById("modeicon")
            .setAttribute("xlink:href", "#icon-sun")),
        setTimeout(function () {
          document.getElementsByClassName(
            "Cuteen_DarkSky",
          )[0].style.transition = "opacity 3s";
          document.getElementsByClassName("Cuteen_DarkSky")[0].style.opacity =
            "0";
          setTimeout(function () {
            document.getElementsByClassName("Cuteen_DarkSky")[0].remove();
          }, 1e3);
        }, 2e3));
    }));
  const nowMode =
    document.documentElement.getAttribute("data-theme") === "dark"
      ? "dark"
      : "light";
  if (nowMode === "light") {
    // å…ˆè®¾ç½®å¤ªé˜³æœˆäº®é€æ˜åº¦
    document.getElementById("sun").style.opacity = "1";
    document.getElementById("moon").style.opacity = "0";
    setTimeout(function () {
      document.getElementById("sun").style.opacity = "0";
      document.getElementById("moon").style.opacity = "1";
    }, 1000);

    activateDarkMode();
    saveToLocal.set("theme", "dark", 2);
    // GLOBAL_CONFIG.Snackbar !== undefined && btf.snackbarShow(GLOBAL_CONFIG.Snackbar.day_to_night)
    document.getElementById("modeicon").setAttribute("xlink:href", "#icon-sun");
    // å»¶æ—¶å¼¹çª—æé†’
    setTimeout(() => {
      new Vue({
        data: function () {
          this.$notify({
            title: "å…³ç¯å•¦ğŸŒ™",
            message: "å½“å‰å·²æˆåŠŸåˆ‡æ¢è‡³å¤œé—´æ¨¡å¼ï¼",
            position: "top-left",
            offset: 50,
            showClose: true,
            type: "success",
            duration: 5000,
          });
        },
      });
    }, 2000);
  } else {
    // å…ˆè®¾ç½®å¤ªé˜³æœˆäº®é€æ˜åº¦
    document.getElementById("sun").style.opacity = "0";
    document.getElementById("moon").style.opacity = "1";
    setTimeout(function () {
      document.getElementById("sun").style.opacity = "1";
      document.getElementById("moon").style.opacity = "0";
    }, 1000);

    activateLightMode();
    saveToLocal.set("theme", "light", 2);
    (document.querySelector("body").classList.add("DarkMode"),
      document
        .getElementById("modeicon")
        .setAttribute("xlink:href", "#icon-moon"));
    setTimeout(() => {
      new Vue({
        data: function () {
          this.$notify({
            title: "å¼€ç¯å•¦ğŸŒ",
            message: "å½“å‰å·²æˆåŠŸåˆ‡æ¢è‡³ç™½å¤©æ¨¡å¼ï¼",
            position: "top-left",
            offset: 50,
            showClose: true,
            type: "success",
            duration: 5000,
          });
        },
      });
    }, 2000);
  }
  // handle some cases
  typeof utterancesTheme === "function" && utterancesTheme();
  typeof FB === "object" && window.loadFBComment();
  window.DISQUS &&
    document.getElementById("disqus_thread").children.length &&
    setTimeout(() => window.disqusReset(), 200);
}

/* å¤œé—´æ¨¡å¼åˆ‡æ¢åŠ¨ç”» end */

//----------------------------------------------------------------

/* åˆ†äº«æŒ‰é’® start */
// åˆ†äº«æœ¬é¡µ
function share_() {
  let url = window.location.origin + window.location.pathname;
  try {
    // æˆªå–æ ‡é¢˜
    var title = document.title;
    var subTitle = title.endsWith("| LolikingğŸª ")
      ? title.substring(0, title.length - 14)
      : title;
    navigator.clipboard.writeText(
      "LolikingğŸª çš„ç«™å†…åˆ†äº«\næ ‡é¢˜ï¼š" +
        subTitle +
        "\né“¾æ¥ï¼š" +
        url +
        "\næ¬¢è¿æ¥è®¿ï¼ğŸ­ğŸ­ğŸ­",
    );
    new Vue({
      data: function () {
        this.$notify({
          title: "æˆåŠŸå¤åˆ¶åˆ†äº«ä¿¡æ¯ğŸ‰",
          message: "æ‚¨ç°åœ¨å¯ä»¥é€šè¿‡ç²˜è´´ç›´æ¥è·Ÿå°ä¼™ä¼´åˆ†äº«äº†ï¼",
          position: "top-left",
          offset: 50,
          showClose: true,
          type: "success",
          duration: 5000,
        });
        // return { visible: false }
      },
    });
  } catch (err) {
    console.error("å¤åˆ¶å¤±è´¥ï¼", err);
  }
  // new ClipboardJS(".share", { text: function () { return 'æ ‡é¢˜ï¼š' + document.title + '\né“¾æ¥ï¼š' + url } });
  // btf.snackbarShow("æœ¬é¡µé“¾æ¥å·²å¤åˆ¶åˆ°å‰ªåˆ‡æ¿ï¼Œå¿«å»åˆ†äº«å§~")
}

// é˜²æŠ–
function share() {
  debounce(share_, 300);
}

/* åˆ†äº«æŒ‰é’® end */

//----------------------------------------------------------------

/* æ¶ææ ‡é¢˜ start */
//åŠ¨æ€æ ‡é¢˜
var OriginTitile = document.title;
var titleTime;
document.addEventListener("visibilitychange", function () {
  if (document.hidden) {
    //ç¦»å¼€å½“å‰é¡µé¢æ—¶æ ‡ç­¾æ˜¾ç¤ºå†…å®¹
    document.title = "â²ï¸ä¸–ç•Œçº¿å˜åŠ¨";
    clearTimeout(titleTime);
  } else {
    //è¿”å›å½“å‰é¡µé¢æ—¶æ ‡ç­¾æ˜¾ç¤ºå†…å®¹
    document.title = "â²ï¸ä¸–ç•Œçº¿æ”¶æŸ";
    //ä¸¤ç§’åå˜å›æ­£å¸¸æ ‡é¢˜
    titleTime = setTimeout(function () {
      document.title = OriginTitile;
    }, 2000);
  }
});
/* æ¶ææ ‡é¢˜ end */

/* å¬è¯é¼ æ ‡ start */
var CURSOR;

Math.lerp = (a, b, n) => (1 - n) * a + n * b;

const getStyle2 = (el, attr) => {
  try {
    return window.getComputedStyle
      ? window.getComputedStyle(el)[attr]
      : el.currentStyle[attr];
  } catch (e) {}
  return "";
};

// ä¸ºäº†å±è”½å¼‚æ­¥åŠ è½½å¯¼è‡´æ— æ³•è¯»å–é¢œè‰²å€¼ï¼Œè¿™é‡Œç»Ÿä¸€ç”¨å“ˆå¸Œè¡¨é¢„å¤„ç†
const map = new Map();
map.set("red", "rgb(241, 71, 71)");
map.set("orange", "rgb(241, 162, 71)");
map.set("yellow", "rgb(241, 238, 71)");
map.set("purple", "rgb(179, 71, 241)");
map.set("blue", "rgb(102, 204, 255)");
map.set("gray", "rgb(226, 226, 226)");
map.set("green", "rgb(57, 197, 187)");
map.set("whitegray", "rgb(241, 241, 241)");
map.set("pink", "rgb(237, 112, 155)");
map.set("black", "rgb(0, 0, 0)");
map.set("darkblue", "rgb(97, 100, 159)");
map.set("heoblue", "rgb(66, 90, 239)");

class Cursor {
  constructor() {
    this.pos = { curr: null, prev: null };
    this.pt = [];
    this.create();
    this.init();
    this.render();
  }

  move(left, top) {
    this.cursor.style["left"] = `${left}px`;
    this.cursor.style["top"] = `${top}px`;
  }

  create() {
    if (!this.cursor) {
      this.cursor = document.createElement("div");
      this.cursor.id = "cursor";
      this.cursor.classList.add("hidden");
      document.body.append(this.cursor);
    }
    var el = document.getElementsByTagName("*");
    // for (let i = 0; i < el.length; i++)
    //   if (getStyle2(el[i], "cursor") == "pointer")
    //     this.pt.push(el[i].outerHTML);
    // var colorVal = map.get(localStorage.getItem("themeColor"));
    document.body.appendChild((this.scr = document.createElement("style")));
    // this.scr.innerHTML = `* {cursor: url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 8' width='8px' height='8px'><circle cx='4' cy='4' r='4' opacity='1.0' fill='` + colorVal + `'/></svg>") 4 4, auto}`;
  }

  refresh() {
    this.scr.remove();
    this.cursor.classList.remove("hover");
    this.cursor.classList.remove("active");
    this.pos = { curr: null, prev: null };
    this.pt = [];

    this.create();
    this.init();
    this.render();
  }

  init() {
    document.onmouseover = (e) =>
      this.pt.includes(e.target.outerHTML) &&
      this.cursor.classList.add("hover");
    document.onmouseout = (e) =>
      this.pt.includes(e.target.outerHTML) &&
      this.cursor.classList.remove("hover");
    document.onmousemove = (e) => {
      this.pos.curr == null && this.move(e.clientX - 8, e.clientY - 8);
      this.pos.curr = { x: e.clientX - 8, y: e.clientY - 8 };
      this.cursor.classList.remove("hidden");
    };
    document.onmouseenter = (e) => this.cursor.classList.remove("hidden");
    document.onmouseleave = (e) => this.cursor.classList.add("hidden");
    document.onmousedown = (e) => this.cursor.classList.add("active");
    document.onmouseup = (e) => this.cursor.classList.remove("active");
  }

  render() {
    if (this.pos.prev) {
      // è·Ÿè¸ªé€Ÿåº¦è°ƒèŠ‚
      this.pos.prev.x = Math.lerp(this.pos.prev.x, this.pos.curr.x, 0.15);
      this.pos.prev.y = Math.lerp(this.pos.prev.y, this.pos.curr.y, 0.15);
      this.move(this.pos.prev.x, this.pos.prev.y);
    } else {
      this.pos.prev = this.pos.curr;
    }
    requestAnimationFrame(() => this.render());
  }
}

(() => {
  CURSOR = new Cursor();
  // éœ€è¦é‡æ–°è·å–åˆ—è¡¨æ—¶ï¼Œä½¿ç”¨ CURSOR.refresh()
})();

/* å¬è¯é¼ æ ‡ end */

//----------------------------------------------------------------

/* æ–°å¹´å€’è®¡æ—¶ start */
// let newYearTimer = null;
// var newYear = () => {
//   clearTimeout(newYearTimer);
//   if (!document.querySelector('#newYear')) return;
//   // æ–°å¹´æ—¶é—´æˆ³ and æ˜ŸæœŸå¯¹è±¡
//   let newYear = new Date('2023-01-22 00:00:00').getTime() / 1000,
//     week = { 0: 'å‘¨æ—¥', 1: 'å‘¨ä¸€', 2: 'å‘¨äºŒ', 3: 'å‘¨ä¸‰', 4: 'å‘¨å››', 5: 'å‘¨äº”', 6: 'å‘¨å…­' }

//   time();

//   // è¡¥é›¶å‡½æ•°
//   function nol(h) { return h > 9 ? h : '0' + h; };

//   function time() {
//     // ç°åœ¨ æ—¶é—´å¯¹è±¡
//     let now = new Date();

//     // å³ä¸‹è§’ ä»Šå¤©
//     document.querySelector('#newYear .today').innerHTML = now.getFullYear() + '-' + (now.getMonth() + 1) + '-' + now.getDate() + ' ' + week[now.getDay()]

//     // ç°åœ¨ä¸æ–°å¹´ç›¸å·®ç§’æ•°
//     let second = newYear - Math.round(now.getTime() / 1000);

//     // å°äº0åˆ™è¡¨ç¤ºå·²ç»è¿‡å¹´
//     if (second < 0) {
//       document.querySelector('#newYear .title').innerHTML = 'Happy New Year!';
//       document.querySelector('#newYear .newYear-time').innerHTML = '<span class="happyNewYear">æ–°å¹´å¿«ä¹</p>';
//     } else {
//       // å¤§äº0åˆ™è¿˜æœªè¿‡å¹´
//       document.querySelector('#newYear .title').innerHTML = 'è·ç¦»2023å¹´æ˜¥èŠ‚ï¼š'

//       // å¤§äºä¸€å¤©åˆ™ç›´æ¥æ¸²æŸ“å¤©æ•°
//       if (second > 86400) {
//         document.querySelector('#newYear .newYear-time').innerHTML = `<span class="day">${Math.ceil(second / 86400)}<span class="unit">å¤©</span></span>`
//       } else {
//         // å°äºä¸€å¤©åˆ™ä½¿ç”¨æ—¶åˆ†ç§’è®¡æ—¶ã€‚
//         let h = nol(parseInt(second / 3600));
//         second %= 3600;
//         let m = nol(parseInt(second / 60));
//         second %= 60;
//         let s = nol(second);
//         document.querySelector('#newYear .newYear-time').innerHTML = `<span class="time">${h}:${m}:${s}</span></span>`;
//         // è®¡æ—¶
//         newYearTimer = setTimeout(time, 1000);
//       }
//     }
//   }

//   // å…ƒå®é£˜è½
//   jQuery(document).ready(function ($) {
//     $('#newYear').wpSuperSnow({
//       flakes: ['https://tuchuang.voooe.cn/images/2023/01/02/yb1.webp', 'https://tuchuang.voooe.cn/images/2023/01/02/yb2.webp', 'https://tuchuang.voooe.cn/images/2023/01/02/yb3.webp'],
//       totalFlakes: '100',
//       zIndex: '999999',
//       maxSize: '30',
//       maxDuration: '20',
//       useFlakeTrans: false
//     });
//   });
// }
// // Pjaxé€‚é…ï¼šè‹¥æ²¡æœ‰å¼€å¯Pjaxè¿™é‡Œç›´æ¥æ˜¯newYear()å³å¯
// // å¼€äº†Pjaxçš„ç”¨ä»¥ä¸‹ä¸¤å¥
// document.addEventListener('pjax:complete', newYear);
// document.addEventListener('DOMContentLoaded', newYear);

/* æ–°å¹´å€’è®¡æ—¶ end */

//----------------------------------------------------------------

/* é¡µè„šè®¡æ—¶å™¨ start */
// var now = new Date();
// function createtime() {
//   // å½“å‰æ—¶é—´
//   now.setTime(now.getTime() + 1000);
//   var start = new Date("08/01/2022 00:00:00"); // æ—…è¡Œè€…1å·å¼€å§‹è®¡ç®—çš„æ—¶é—´
//   var dis = Math.trunc(23400000000 + ((now - start) / 1000) * 17); // è·ç¦»=ç§’æ•°*é€Ÿåº¦ è®°ä½è½¬æ¢æ¯«ç§’
//   var unit = (dis / 149600000).toFixed(6);  // å¤©æ–‡å•ä½
//   // ç½‘ç«™è¯ç”Ÿæ—¶é—´
//   var grt = new Date("19/09/2024 00:00:00");
//   var days = (now - grt) / 1e3 / 60 / 60 / 24,
//     dnum = Math.floor(days),
//     hours = (now - grt) / 1e3 / 60 / 60 - 24 * dnum,
//     hnum = Math.floor(hours);
//   1 == String(hnum).length && (hnum = "0" + hnum);
//   var minutes = (now - grt) / 1e3 / 60 - 1440 * dnum - 60 * hnum,
//     mnum = Math.floor(minutes);
//   1 == String(mnum).length && (mnum = "0" + mnum);
//   var seconds = (now - grt) / 1e3 - 86400 * dnum - 3600 * hnum - 60 * mnum,
//     snum = Math.round(seconds);
//   1 == String(snum).length && (snum = "0" + snum);
//   let currentTimeHtml = "";
//   (currentTimeHtml =
//     hnum < 18 && hnum >= 9
//       ? `<img class='boardsign' src='https://img.shields.io/badge/%E8%90%8C%E7%8E%8B-%E4%B9%8B%E4%B9%A1-pink' title='èè‰æ‹¯æ•‘ä¸–ç•Œ'><br>`
//       : `<img class='boardsign' src='https://img.shields.io/badge/%E8%90%8C%E7%8E%8B-%E4%B9%8B%E4%B9%A1-blue' title='èè‰æŠ¥å¤ä¸–ç•Œ'><br>`),
//     document.getElementById("workboard") &&
//     (document.getElementById("workboard").innerHTML = currentTimeHtml);
// }
// // è®¾ç½®é‡å¤æ‰§è¡Œå‡½æ•°ï¼Œå‘¨æœŸ1000ms
// setInterval(() => {
//   createtime();
// }, 1000);

/*é¡µè„šè®¡æ—¶å™¨ end */

//----------------------------------------------------------------

/* fpsæ£€æµ‹ start */
if (window.localStorage.getItem("fpson") == "1") {
  var rAF = (function () {
    return (
      window.requestAnimationFrame ||
      window.webkitRequestAnimationFrame ||
      function (callback) {
        window.setTimeout(callback, 1000 / 60);
      }
    );
  })();
  var frame = 0;
  var allFrameCount = 0;
  var lastTime = Date.now();
  var lastFameTime = Date.now();
  var loop = function () {
    var now = Date.now();
    var fs = now - lastFameTime;
    var fps = Math.round(1000 / fs);

    lastFameTime = now;
    // ä¸ç½® 0ï¼Œåœ¨åŠ¨ç”»çš„å¼€å¤´åŠç»“å°¾è®°å½•æ­¤å€¼çš„å·®å€¼ç®—å‡º FPS
    allFrameCount++;
    frame++;

    if (now > 1000 + lastTime) {
      var fps = Math.round((frame * 1000) / (now - lastTime));
      if (fps <= 5) {
        var kd = `<span style="color:#bd0000">å¡æˆpptğŸ¤¢</span>`;
      } else if (fps <= 15) {
        var kd = `<span style="color:red">ç”µç«çº§å¸§ç‡ğŸ˜–</span>`;
      } else if (fps <= 25) {
        var kd = `<span style="color:orange">æœ‰ç‚¹éš¾å—ğŸ˜¨</span>`;
      } else if (fps < 35) {
        var kd = `<span style="color:#9338e6">ä¸å¤ªæµç•…ğŸ™„</span>`;
      } else if (fps <= 45) {
        var kd = `<span style="color:#08b7e4">è¿˜ä¸é”™å“¦ğŸ˜</span>`;
      } else {
        var kd = `<span style="color:#39c5bb">ååˆ†æµç•…ğŸ¤£</span>`;
      }
      document.getElementById("fps").innerHTML = `FPS:${fps} ${kd}`;
      frame = 0;
      lastTime = now;
    }

    rAF(loop);
  };

  loop();
} else {
  document.getElementById("fps").style = "display:none!important";
}
/* fpsæ£€æµ‹ end */

//----------------------------------------------------------------

/* ç¾åŒ–æ¨¡å— start */

// æ›´æ–°ç‰ˆæœ¬éœ€è¦æ¯ä¸ªç”¨æˆ·éƒ½æ¢å¤ä¸€æ¬¡é»˜è®¤è®¾ç½®
if (localStorage.getItem("reset_4") == undefined) {
  localStorage.setItem("reset_4", "1");
  // æ¸…ç©ºä¹‹å‰çš„æ ‡è®°å€¼
  for (var i = 1; i <= 3; i++) {
    localStorage.removeItem("reset_" + i);
  }
  clearItem();
  setTimeout(function () {
    new Vue({
      data: function () {
        this.$notify({
          title: "æç¤ºğŸ’",
          message:
            " (ï½¡ï½¥âˆ€ï½¥)ï¾‰ï¾ç”±äºç½‘ç«™éƒ¨åˆ†è®¾ç½®é¡¹æ›´æ–°ï¼Œå½“å‰å·²ä¸ºæ‚¨é‡ç½®æ‰€æœ‰è®¾ç½®ï¼Œç¥æ‚¨æ„‰å¿«ï¼",
          position: "top-left",
          offset: 50,
          showClose: true,
          type: "success",
          duration: 8000,
        });
      },
    });
  }, 1500);
}

// æ¸…é™¤localStorageé…ç½®é¡¹
function clearItem() {
  localStorage.removeItem("blogbg");
  localStorage.removeItem("universe");
  localStorage.removeItem("blur");
  localStorage.removeItem("fpson");
  localStorage.removeItem("transNum");
  localStorage.removeItem("blurRad");
  localStorage.removeItem("font");
  localStorage.removeItem("themeColor");
  localStorage.removeItem("rs");
  // localStorage.removeItem('mouse');
  localStorage.removeItem("light");
  localStorage.removeItem("snow");
}

// è®¾ç½®å­—ä½“
if (localStorage.getItem("font") == undefined) {
  localStorage.setItem("font", "LXGW");
}
setFont(localStorage.getItem("font"));
function setFont(n) {
  localStorage.setItem("font", n);
  if (n == "default") {
    document.documentElement.style.setProperty(
      "--global-font",
      "-apple-system",
    );
    document.body.style.fontFamily =
      "-apple-system, Consolas_1, BlinkMacSystemFont, 'Segoe UI' , 'Helvetica Neue' , Lato, Roboto, 'PingFang SC' , 'Microsoft JhengHei' , 'Microsoft YaHei' , sans-serif";
  } else {
    document.documentElement.style.setProperty("--global-font", n);
    document.body.style.fontFamily =
      "var(--global-font),-apple-system, IBM Plex Mono ,monosapce,'å¾®è½¯é›…é»‘', sans-serif";
  }
  try {
    setFontBorder();
  } catch (err) {}
}

// è®¾ç½®å­—ä½“é€‰æ‹©æ¡†è¾¹ç•Œ
function setFontBorder() {
  var curFont = localStorage.getItem("font");
  var swfId = "swf_" + curFont;
  document.getElementById(swfId).style.border = "2px solid var(--theme-color)";
  Array.prototype.forEach.call(
    document.getElementsByClassName("swf"),
    function (ee) {
      if (ee.id != swfId) ee.style.border = "2px solid var(--border-color)";
    },
  );
}

// è®¾ç½®ä¸»é¢˜è‰²
if (localStorage.getItem("themeColor") == undefined) {
  localStorage.setItem("themeColor", "pink");
}
setColor(localStorage.getItem("themeColor"));
function setColor(c) {
  document.getElementById("themeColor").innerText =
    `:root{--theme-color:` + map.get(c) + ` !important}`;
  localStorage.setItem("themeColor", c);
  // åˆ·æ–°é¼ æ ‡é¢œè‰²
  CURSOR.refresh();
  // è®¾ç½®ä¸€ä¸ªå¸¦æœ‰é€æ˜åº¦çš„ä¸»é¢˜è‰²ï¼Œç”¨äºèœå•æ çš„æ‚¬æµ®é¢œè‰²
  var theme_color = map.get(c);
  var trans_theme_color =
    "rgba" + theme_color.substring(3, theme_color.length - 1) + ", 0.7)";
  var high_trans_color =
    "rgba" + theme_color.substring(3, theme_color.length - 1) + ", 0.5)";
  document.documentElement.style.setProperty(
    "--text-bg-hover",
    trans_theme_color,
  );
  document.documentElement.style.setProperty(
    "--high-trans-color",
    high_trans_color,
  );
}

// æ˜Ÿç©ºèƒŒæ™¯å¼€å…³
if (localStorage.getItem("universe") == undefined) {
  localStorage.setItem("universe", "block");
}
setUniverse2(localStorage.getItem("universe"));
function setUniverse2(c) {
  document.getElementById("universe").style.display = c;
  localStorage.setItem("universe", c);
}
function setUniverse() {
  if (document.getElementById("universeSet").checked) {
    setUniverse2("block");
  } else {
    setUniverse2("none");
  }
}

// é›ªèŠ±å¼€å…³
if (localStorage.getItem("snow") == undefined) {
  localStorage.setItem("snow", "none");
}
document.getElementById("snow").style.display = localStorage.getItem("snow");
function setSnow() {
  if (document.getElementById("snowSet").checked) {
    document.getElementById("snow").style.display = "block";
    localStorage.setItem("snow", "block");
  } else {
    document.getElementById("snow").style.display = "none";
    localStorage.setItem("snow", "none");
  }
}

// å¸§ç‡ç›‘æµ‹å¼€å…³
if (localStorage.getItem("fpson") == undefined) {
  localStorage.setItem("fpson", "0");
}
function fpssw() {
  if (document.getElementById("fpson").checked) {
    localStorage.setItem("fpson", "1");
  } else {
    localStorage.setItem("fpson", "0");
  }
  setTimeout(reload, 600);
}

// åˆ·æ–°çª—å£
function reload() {
  window.location.reload();
}

// ä¾§è¾¹æ å¼€å…³
if (localStorage.getItem("rs") == undefined) {
  localStorage.setItem("rs", "block");
}
if (localStorage.getItem("rs") == "block") {
  document.getElementById("rightSide").innerText =
    `:root{--rightside-display: block}`;
} else {
  document.getElementById("rightSide").innerText =
    `:root{--rightside-display: none}`;
}
function toggleRightside() {
  // å…ˆè®¾ç½®localStorageå˜é‡
  if (document.getElementById("rightSideSet").checked) {
    localStorage.setItem("rs", "block");
    document.getElementById("rightSide").innerText =
      `:root{--rightside-display: block}`;
  } else {
    localStorage.setItem("rs", "none");
    document.getElementById("rightSide").innerText =
      `:root{--rightside-display: none}`;
  }
}

// é€æ˜åº¦è°ƒèŠ‚æ»‘å—
if (localStorage.getItem("transNum") == undefined) {
  localStorage.setItem("transNum", 95);
}
var curTransNum = localStorage.getItem("transNum");
var curTransMini = curTransNum * 0.95;
document.getElementById("transPercent").innerText =
  `:root{--trans-light: rgba(253, 253, 253, ${curTransNum}%) !important; --trans-dark: rgba(25, 25, 25, ${curTransNum}%) !important} `;
function setTrans() {
  var elem = document.getElementById("transSet");
  var newTransNum = elem.value;
  var target = document.querySelector(".transValue");
  target.innerHTML = "é€æ˜åº¦ (0%-100%): " + newTransNum + "%";
  localStorage.setItem("transNum", newTransNum);
  curTransMini = newTransNum * 0.95;
  curTransNum = newTransNum; // æ›´æ–°å½“å‰é€æ˜åº¦
  document.querySelector("#rang_trans").style.width = curTransMini + "%";
  document.getElementById("transPercent").innerText =
    `:root{--trans-light: rgba(253, 253, 253, ${newTransNum}%) !important; --trans-dark: rgba(25, 25, 25, ${newTransNum}%) !important} `;
}

// æ¨¡ç³Šåº¦è°ƒèŠ‚æ»‘å—
if (localStorage.getItem("blurRad") == undefined) {
  localStorage.setItem("blurRad", 20);
}
var curBlur = localStorage.getItem("blurRad"); // å½“å‰æ¨¡ç³ŠåŠå¾„
var miniBlur = curBlur * 0.95;
document.getElementById("blurNum").innerText =
  `:root{--blur-num: blur(${curBlur}px) saturate(120%) !important`;
function setBlurNum() {
  var elem = document.getElementById("blurSet");
  var newBlur = elem.value;
  var target = document.querySelector(".blurValue");
  target.innerHTML = "æ¨¡ç³ŠåŠå¾„ (å¼€å¯æ¨¡ç³Šç”Ÿæ•ˆ 0px-100px): " + newBlur + "px";
  localStorage.setItem("blurRad", newBlur);
  curBlur = newBlur;
  miniBlur = curBlur * 0.95;
  // var max = elem.getAttribute("max");
  document.querySelector("#rang_blur").style.width = miniBlur + "%";
  document.getElementById("blurNum").innerText =
    `:root{--blur-num: blur(${curBlur}px) saturate(120%) !important`;
}

// æ¨¡ç³Šæ•ˆæœå¼€å…³
if (localStorage.getItem("blur") == undefined) {
  localStorage.setItem("blur", 0);
}
if (localStorage.getItem("blur") == 0) {
  document.getElementById("settingStyle").innerText =
    `:root{--backdrop-filter: none}`;
} else {
  document.getElementById("settingStyle").innerText =
    `:root{--backdrop-filter: var(--blur-num)}`;
}
function setBlur() {
  if (document.getElementById("blur").checked) {
    localStorage.setItem("blur", 1);
    document.getElementById("settingStyle").innerText =
      `:root{--backdrop-filter: var(--blur-num)}`;
  } else {
    localStorage.setItem("blur", 0);
    document.getElementById("settingStyle").innerText =
      `:root{--backdrop-filter: none}`;
  }
}

// æ›´æ¢èƒŒæ™¯(åŸæ¥Leonusçš„ä»£ç )
// å­˜æ•°æ®
// nameï¼šå‘½å dataï¼šæ•°æ®
// function saveData(name, data) {
//   localStorage.setItem(name, JSON.stringify({ time: Date.now(), data: data }));
// }
// å–æ•°æ®
// nameï¼šå‘½å timeï¼šè¿‡æœŸæ—¶é•¿,å•ä½åˆ†é’Ÿ,å¦‚ä¼ å…¥30,å³åŠ è½½æ•°æ®æ—¶å¦‚æœè¶…å‡º30åˆ†é’Ÿè¿”å›0,å¦åˆ™è¿”å›æ•°æ®
// function loadData(name, time) {
//   let d = JSON.parse(localStorage.getItem(name));
//   // è¿‡æœŸæˆ–æœ‰é”™è¯¯è¿”å› 0 å¦åˆ™è¿”å›æ•°æ®
//   if (d) {
//     let t = Date.now() - d.time;
//     if (t < time * 60 * 1000 && t > -1) return d.data;
//   }
//   return 0;
// }
// ä¸Šé¢ä¸¤ä¸ªå‡½æ•°å¦‚æœä½ æœ‰å…¶ä»–éœ€è¦å­˜å–æ•°æ®çš„åŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨
// è¯»å–èƒŒæ™¯
// try {
//   let data = loadData("blogbg", 1440);
//   if (data) changeBg(data, 1);
//   else localStorage.removeItem("blogbg");
// } catch (error) {
//   localStorage.removeItem("blogbg");
// }
// åˆ‡æ¢èƒŒæ™¯å‡½æ•°
// æ­¤å¤„çš„flagæ˜¯ä¸ºäº†æ¯æ¬¡è¯»å–æ—¶éƒ½é‡æ–°å­˜å‚¨ä¸€æ¬¡,å¯¼è‡´è¿‡æœŸæ—¶é—´ä¸ç¨³å®š
// å¦‚æœflagä¸º0åˆ™å­˜å‚¨,å³è®¾ç½®èƒŒæ™¯. ä¸º1åˆ™ä¸å­˜å‚¨,å³æ¯æ¬¡åŠ è½½è‡ªåŠ¨è¯»å–èƒŒæ™¯.
// function changeBg(s, flag) {
//   let bg = document.getElementById("web_bg");
//   if (s.charAt(0) == "#") {
//     bg.style.backgroundColor = s;
//     bg.style.backgroundImage = "none";
//   } else {
//     bg.style.backgroundImage = s
//   };
//   if (!flag) {
//     saveData("blogbg", s);
//   }
// }

// åˆ‡æ¢è‡ªå®šä¹‰é¢œè‰²
var defineColor =
  localStorage.getItem("blogbg") &&
  localStorage.getItem("blogbg").charAt(0) == "#"
    ? localStorage.getItem("blogbg")
    : "#F4D88A";
function changeBgColor() {
  changeBg(document.querySelector("#define_colors").value);
}

// å¿…åº”æ¯æ—¥å£çº¸API
let bingDayBg =
  screen.width <= 768
    ? "url(https://bing.img.run/m.php)"
    : "url(https://bing.img.run/1920x1080.php)";
// å¿…åº”å†å²å£çº¸API
let bingHistoryBg =
  screen.width <= 768
    ? "url(https://bing.img.run/rand_m.php)"
    : "url(https://bing.img.run/rand.php)";
// EEE.DOG
let EEEDog = "url(https://api.yimian.xyz/img?type=moe&size=1920x1080)";
// éšæœºç¾å›¾cdn.seovx.com
let seovx = "url(https://cdn.seovx.com/?mom=302)";
// picsuméšæœº
let picsum = "url(https://picsum.photos/1920/1080.webp)";
// å°æ­ªäºŒæ¬¡å…ƒ
// let waiDongman = "url(https://api.ixiaowai.cn/api/api.php)";
//  å°æ­ªé«˜æ¸…å£çº¸
let waiBizhi = "url(https://api.ixiaowai.cn/gqapi/gqapi.php)";
// åšå¤©éšæœº
let btstu = "url(http://api.btstu.cn/sjbz/?lx=suiji)";
// tuapi åŠ¨æ¼«
// let tuapi = "url(https://tuapi.eees.cc/api.php?category=dongman)";
// unsplashéšæœº https://source.unsplash.com/random/1920x1080/daily (weekly)
let unsplash = "url(https://source.unsplash.com/random/1920x1080/)";

// æ›´æ¢èƒŒæ™¯(è‡ªå·±çš„ä»£ç )
if (localStorage.getItem("blogbg") != undefined) {
  setBg(localStorage.getItem("blogbg"));
} else {
  document.getElementById("defineBg").innerText = `:root{
    --default-bg: url(/img/day.webp);
    --darkmode-bg:url(/img/night.webp);
    --mobileday-bg: url(/img/mobile.webp);
    --mobilenight-bg: url(/img/mobile.webp);
  }`;
}
// åˆ‡æ¢èƒŒæ™¯ä¸»å‡½æ•°
function changeBg(s) {
  // è‡ªå®šä¹‰é¢œè‰²æ¡†
  defineColor = s.charAt(0) == "#" ? s : "#F4D88A";
  setBg(s);
  localStorage.setItem("blogbg", s);
}
// è®¾ç½®èƒŒæ™¯å±æ€§
function setBg(s) {
  document.getElementById("defineBg").innerText = `:root{
    --default-bg: ${s};
    --darkmode-bg: ${s};
    --mobileday-bg: ${s};
    --mobilenight-bg: ${s};
  }`;
}

// åˆ‡æ¢é“¾æ¥å¯¹åº”çš„èƒŒæ™¯(åŠ å…¥äº†é“¾æ¥æ£€éªŒä¸é˜²æŠ–)
function getPicture() {
  debounce(getPicture_, 300);
}

function getPicture_() {
  checkImgExists(document.getElementById("pic-link").value)
    .then(() => {
      // æœ‰æ•ˆçš„å›¾ç‰‡é“¾æ¥
      var link = "url(" + document.getElementById("pic-link").value + ")";
      changeBg(link);
      // æç¤ºåˆ‡æ¢æˆåŠŸ
      new Vue({
        data: function () {
          this.$notify({
            title: "å¯ä»¥å•¦ğŸ¨",
            message: "åˆ‡æ¢è‡ªå®šä¹‰èƒŒæ™¯æˆåŠŸï¼",
            position: "top-left",
            offset: 50,
            showClose: true,
            type: "success",
            duration: 5000,
          });
        },
      });
    })
    .catch(() => {
      // æ— æ•ˆçš„å›¾ç‰‡é“¾æ¥ï¼Œæç¤ºæ— æ•ˆ
      new Vue({
        data: function () {
          this.$notify({
            title: "é“¾æ¥ä¸å¯¹ğŸ¤£",
            message: "è¯·è¾“å…¥æœ‰æ•ˆçš„å›¾ç‰‡é“¾æ¥ï¼",
            position: "top-left",
            offset: 50,
            showClose: true,
            type: "warning",
            duration: 5000,
          });
        },
      });
    });
}
// åˆ¤æ–­å›¾ç‰‡é“¾æ¥æ˜¯å¦å¯ç”¨
function checkImgExists(imgurl) {
  return new Promise(function (resolve, reject) {
    var ImgObj = new Image();
    ImgObj.src = imgurl;
    ImgObj.onload = function (res) {
      resolve(res);
    };
    ImgObj.onerror = function (err) {
      reject(err);
    };
  });
}

// é»‘å¤œéœ“è™¹ç¯å¼€å…³
if (localStorage.getItem("light") == undefined) {
  localStorage.setItem("light", "true");
}
// è¿™é‡Œè¦é€‚é…Pjax
document.addEventListener("pjax:complete", function () {
  changeLight(localStorage.getItem("light") == "true" ? true : false);
});
document.addEventListener("DOMContentLoaded", function () {
  changeLight(localStorage.getItem("light") == "true" ? true : false);
});
function setLight() {
  if (document.getElementById("lightSet").checked) {
    changeLight(true);
    localStorage.setItem("light", "true");
  } else {
    changeLight(false);
    localStorage.setItem("light", "false");
  }
}
// æ›´æ¢éœ“è™¹ç¯çŠ¶æ€
function changeLight(flag) {
  if (document.getElementById("site-name"))
    document.getElementById("site-name").style.animation = flag
      ? "light_15px 10s linear infinite"
      : "none";
  if (document.getElementById("site-title"))
    document.getElementById("site-title").style.animation = flag
      ? "light_15px 10s linear infinite"
      : "none";
  if (document.getElementById("site-subtitle"))
    document.getElementById("site-subtitle").style.animation = flag
      ? "light_10px 10s linear infinite"
      : "none";
  if (document.getElementById("post-info"))
    document.getElementById("post-info").style.animation = flag
      ? "light_5px 10s linear infinite"
      : "none";
  document.getElementById("menu_shadow").innerText = flag
    ? `:root{--menu-shadow: 0 0 1px var(--theme-color);}`
    : `:root{--menu-shadow: none;}`;
}

// è§£å†³å¼€å¯Pjaxçš„é—®é¢˜
// function whenDOMReady() {
//   try {
//     let data = loadData('blogbg', 1440)
//     if (data) changeBg_noWindow(data, 0)
//     else localStorage.removeItem('blogbg');
//   } catch (error) { localStorage.removeItem('blogbg'); }
// }
// whenDOMReady()
// document.addEventListener("pjax:success", whenDOMReady)

// æ— å¼¹çª—æé†’æ›´æ¢èƒŒæ™¯
// function changeBg_noWindow(s, flag) {
//   let bg = document.getElementById("web_bg");
//   if (s.charAt(0) == "#") {
//     bg.style.backgroundColor = s;
//     bg.style.backgroundImage = "none";
//   } else bg.style.backgroundImage = s;
//   if (!flag) {
//     saveData("blogbg", s);
//   }
// }

// åˆ›å»ºçª—å£
var winbox = "";

function createWinbox() {
  let div = document.createElement("div");
  document.body.appendChild(div);
  winbox = WinBox({
    id: "meihuaBox",
    index: 99,
    title: "ç¾åŒ–è®¾ç½®",
    x: "left",
    y: "center",
    minwidth: "300px",
    height: "60%",
    // "#76c8f1"
    background: "var(--theme-color)",
    onmaximize: () => {
      div.innerHTML = `<style>body::-webkit-scrollbar {display: none;} div#meihuaBox {width: 100% !important;}</style>`;
    },
    onrestore: () => {
      div.innerHTML = "";
    },
  });
  winResize();
  window.addEventListener("resize", winResize);

  // æ¯ä¸€ç±»æˆ‘æ”¾äº†ä¸€ä¸ªæ¼”ç¤ºï¼Œç›´æ¥å¾€ä¸‹å¤åˆ¶ç²˜è´´ aæ ‡ç­¾ å°±å¯ä»¥ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ å‡½æ•°é‡Œé¢çš„é“¾æ¥ å†’å·å‰é¢éœ€è¦æ·»åŠ åæ–œæ \è¿›è¡Œè½¬ä¹‰
  winbox.body.innerHTML = `
<div class="settings" style="display: block;">
<div id="article-container" style="padding:12px;">
<br>
<center><p><button onclick="reset()" style="background:linear-gradient(to right, #fc354c, #0abfbc);display:block;width:40%;padding:15px 0;border-radius:30px;color:white;font-size:1.1em;"><i class="fa-solid fa-arrows-rotate"></i>&nbsp;æ¢å¤é»˜è®¤è®¾ç½®</button></p></center>

<h2>ä¸€ã€æ˜¾ç¤ºåå¥½</h2>

<div class="transValue" style="font-weight:bold;padding-left:10px">é€æ˜åº¦ (0%-100%): ${curTransNum}%</div>
<div class="range">
  <input id="transSet" type="range" min="0" max="100" step="1" value=${curTransNum} oninput="setTrans()">
  <p class="rang_width" id="rang_trans" style="width:${curTransMini}%"></p>
</div>

<div class="blurValue" style="font-weight:bold;padding-left:10px">æ¨¡ç³ŠåŠå¾„ (å¼€å¯æ¨¡ç³Šç”Ÿæ•ˆ 0px-100px): ${curBlur} px</div>
<div class="range">
  <input id="blurSet" type="range" min="0" max="100" step="1" value="${curBlur}" oninput="setBlurNum()">
  <p class="rang_width" id="rang_blur" style="width:${miniBlur}%"></p>
</div>


<div class="content" style="display:flex">
  <div class="content-text" style="font-weight:bold; padding-left:10px"> æ˜Ÿç©ºç‰¹æ•ˆ (å¤œé—´æ¨¡å¼) </div><input type="checkbox" id="universeSet" onclick="setUniverse()">
  <div class="content-text" style="font-weight:bold; padding-left:20px"> éœ“è™¹ç¯ (å¤œé—´æ¨¡å¼) </div><input type="checkbox" id="lightSet" onclick="setLight()">
</div>

<div class="content" style="display:flex">
  <div class="content-text" style="font-weight:bold; padding-left:10px"> æ¨¡ç³Šæ•ˆæœ (æ¶ˆè€—æ€§èƒ½) </div><input type="checkbox" id="blur" onclick="setBlur()">
  <div class="content-text" style="font-weight:bold; padding-left:20px"> ä¾§è¾¹æ  (é»˜è®¤å¼€) </div><input type="checkbox" id="rightSideSet" onclick="toggleRightside()">
</div>

<div class="content" style="display:flex">
  <div class="content-text" style="font-weight:bold; padding-left:10px"> å¸§ç‡ç›‘æµ‹ (åˆ·æ–°ç”Ÿæ•ˆ) </div><input type="checkbox" id="fpson" onclick="fpssw()">
  <div class="content-text" style="font-weight:bold; padding-left:10px"> é›ªèŠ±ç‰¹æ•ˆ (ç™½å¤©æ¨¡å¼) </div><input type="checkbox" id="snowSet" onclick="setSnow()">
</div>


<h2>äºŒã€å­—ä½“è®¾ç½®</h2>
<div class="note warning modern">éå•†å…å­—ä½“æœªç»æˆæƒåªèƒ½ä¸ªäººä½¿ç”¨ã€‚æœ¬ç«™ä¸ºå®Œå…¨éå•†ä¸šã€éç›ˆåˆ©æ€§è´¨çš„ç½‘ç«™ï¼Œå¹³æ—¶ç”¨äºä¸ªäººå­¦ä¹ äº¤æµï¼Œå¦‚æœ‰ä¾µæƒè¯·è”ç³»ç«™é•¿åˆ é™¤ï¼Œè°¢è°¢ï¼ â€”â€” è‡´ç‰ˆæƒæ–¹</p>\n</div>\n
<p id="swfs">
<a class="swf" id="swf_ZhuZiAWan" href="javascript:;" rel="noopener external nofollow" style="font-family:'ZhuZiAWan'!important;color:black" onclick="setFont('ZhuZiAWan')">ç­‘ç´«Aä¸¸æ ‡å‡†ä½“2.0</a>
<a class="swf" id="swf_HYTMR" href="javascript:;" rel="noopener external nofollow" style="font-family:'HYTMR'!important;color:black" onclick="setFont('HYTMR')">æ±‰ä»ªå”ç¾äºº</a>
<a class="swf" id="swf_LXGW" href="javascript:;" rel="noopener external nofollow" style="font-family:'LXGW'!important;color:black" onclick="setFont('LXGW')">éœé¹œæ–‡æ¥·</a>
<a class="swf" id="swf_TTQHB" href="javascript:;" rel="noopener external nofollow" style="font-family:'TTQHB'!important;color:black" onclick="setFont('TTQHB')">ç”œç”œåœˆæµ·æŠ¥</a>
<a class="swf" id="swf_YSHST" href="javascript:;" rel="noopener external nofollow" style="font-family:'YSHST'!important;color:black" onclick="setFont('YSHST')">ä¼˜è®¾å¥½èº«ä½“</a>
<a class="swf" id="swf_MiSans" href="javascript:;" rel="noopener external nofollow" style="font-family:'MiSans'!important;color:black" onclick="setFont('MiSans')">MiSans</a>
<a class="swf" id="swf_default" href="javascript:;" rel="noopener external nofollow" style="font-family:-apple-system, IBM Plex Mono ,monosapce,'å¾®è½¯é›…é»‘', sans-serif;!important;color:black" onclick="setFont('default')">ç³»ç»Ÿé»˜è®¤</a>
</p>

<h2>ä¸‰ã€ä¸»é¢˜è‰²è®¾ç½®</h2>
<div class="content" style="display:flex"><input type="radio" id="red" name="colors" value=" "
        onclick="setColor('red')"><input type="radio" id="orange" name="colors" value=" "
        onclick="setColor('orange')"><input type="radio" id="yellow" name="colors" value=" "
        onclick="setColor('yellow')"><input type="radio" id="green" name="colors" value=" "
        onclick="setColor('green')"><input type="radio" id="blue" name="colors" value=" "
        onclick="setColor('blue')"><input type="radio" id="heoblue" name="colors" value=" "
        onclick="setColor('heoblue')"><input type="radio" id="darkblue" name="colors" value=" "
        onclick="setColor('darkblue')"><input type="radio" id="purple" name="colors" value=" "
        onclick="setColor('purple')"><input type="radio" id="pink" name="colors" value=" "
        onclick="setColor('pink')" checked="checked"><input type="radio" id="black" name="colors" value=" "
        onclick="setColor('black')"><input type="radio" id="blackgray" name="colors" value=" "
        onclick="setColor('blackgray')"></div>

<h2>å››ã€èƒŒæ™¯è®¾ç½®</h2>
<center><button onclick="resetBg()" style="background:var(--theme-color);display:block;width:35%;padding:15px 0;border-radius:30px;color:white;"><i class="fa-solid fa-arrows-rotate"></i>&nbsp;æ¢å¤é»˜è®¤èƒŒæ™¯</button></center>

<h3>1. äºŒæ¬¡å…ƒ</h3>

\n<details class="folding-tag" cyan><summary> æŸ¥çœ‹äºŒæ¬¡å…ƒèƒŒæ™¯ </summary>\n              <div class='content'>\n              <div class="bgbox"><a href="javascript:;" rel="noopener external nofollow" style="background-image:url(https://sourcebucket.s3.bitiful.net/img/yuanshen1.webp)" class="imgbox" onclick="changeBg('url(https://sourcebucket.s3.bitiful.net/img/yuanshen1.webp)')"></a><a href="javascript:;" rel="noopener external nofollow" style="background-image:url(https://sourcebucket.s3.bitiful.net/img/dm15.webp)" class="imgbox" onclick="changeBg('url(https://sourcebucket.s3.bitiful.net/img/dm15.webp)')"></a><a href="javascript:;" rel="noopener external nofollow" style="background-image:url(https://sourcebucket.s3.bitiful.net/img/dm2.webp)" class="imgbox" onclick="changeBg('url(https://sourcebucket.s3.bitiful.net/img/dm2.webp)')"></a><a href="javascript:;" rel="noopener external nofollow" style="background-image:url(https://sourcebucket.s3.bitiful.net/img/dm7.webp)" class="imgbox" onclick="changeBg('url(https://sourcebucket.s3.bitiful.net/img/dm7.webp)')"></a><a href="javascript:;" rel="noopener external nofollow" style="background-image:url(https://sourcebucket.s3.bitiful.net/img/dm8.webp)" class="imgbox" onclick="changeBg('url(https://sourcebucket.s3.bitiful.net/img/dm8.webp)')"></a><a href="javascript:;" rel="noopener external nofollow" style="background-image:url(https://sourcebucket.s3.bitiful.net/img/dm3.webp)" class="imgbox" onclick="changeBg('url(https://sourcebucket.s3.bitiful.net/img/dm3.webp)')"></a><a href="javascript:;" rel="noopener external nofollow" style="background-image:url(https://sourcebucket.s3.bitiful.net/img/dm11.webp)" class="imgbox" onclick="changeBg('url(https://sourcebucket.s3.bitiful.net/img/dm11.webp)')"></a><a href="javascript:;" rel="noopener external nofollow" style="background-image:url(https://sourcebucket.s3.bitiful.net/img/dm12.webp)" class="imgbox" onclick="changeBg('url(https://sourcebucket.s3.bitiful.net/img/dm12.webp)')"></a></div>\n              </div>\n            </details>\n\n\n

<h3>2. é£æ™¯</h3>

\n\n<details class="folding-tag" cyan><summary> æŸ¥çœ‹é£æ™¯èƒŒæ™¯ </summary>\n              <div class='content'>\n              <div class="bgbox"><a href="javascript:;" rel="noopener external nofollow" style="background-image:url(https://sourcebucket.s3.bitiful.net/img/fj1.webp)" class="imgbox" onclick="changeBg('url(https://sourcebucket.s3.bitiful.net/img/fj1.webp)')"></a><a href="javascript:;" rel="noopener external nofollow" style="background-image:url(https://sourcebucket.s3.bitiful.net/img/fj2.webp)" class="imgbox" onclick="changeBg('url(https://sourcebucket.s3.bitiful.net/img/fj2.webp)')"></a><a href="javascript:;" rel="noopener external nofollow" style="background-image:url(https://sourcebucket.s3.bitiful.net/img/fj3.webp)" class="imgbox" onclick="changeBg('url(https://sourcebucket.s3.bitiful.net/img/fj3.webp)')"></a><a href="javascript:;" rel="noopener external nofollow" style="background-image:url(https://sourcebucket.s3.bitiful.net/img/fj4.webp)" class="imgbox" onclick="changeBg('url(https://sourcebucket.s3.bitiful.net/img/fj4.webp)')"></a><a href="javascript:;" rel="noopener external nofollow" style="background-image:url(https://sourcebucket.s3.bitiful.net/img/fj5.webp)" class="imgbox" onclick="changeBg('url(https://sourcebucket.s3.bitiful.net/img/fj5.webp)')"></a><a href="javascript:;" rel="noopener external nofollow" style="background-image:url(https://sourcebucket.s3.bitiful.net/img/fj6.webp)" class="imgbox" onclick="changeBg('url(https://sourcebucket.s3.bitiful.net/img/fj6.webp)')"></a><a href="javascript:;" rel="noopener external nofollow" style="background-image:url(https://sourcebucket.s3.bitiful.net/img/fj7.webp)" class="imgbox" onclick="changeBg('url(https://sourcebucket.s3.bitiful.net/img/fj7.webp)')"></a><a href="javascript:;" rel="noopener external nofollow" style="background-image:url(https://sourcebucket.s3.bitiful.net/img/fj8.webp)" class="imgbox" onclick="changeBg('url(https://sourcebucket.s3.bitiful.net/img/fj8.webp)')"></a></div>\n              </div>\n            </details>\n\n

<h3>3. èŒå® </h3>

\n\n<details class="folding-tag" cyan><summary> æŸ¥çœ‹èŒå® èƒŒæ™¯ </summary>\n              <div class='content'>\n              <div class="bgbox"><a href="javascript:;" rel="noopener external nofollow" style="background-image:url(https://sourcebucket.s3.bitiful.net/img/mc1.webp)" class="imgbox" onclick="changeBg('url(https://sourcebucket.s3.bitiful.net/img/mc1.webp)')"></a><a href="javascript:;" rel="noopener external nofollow" style="background-image:url(https://sourcebucket.s3.bitiful.net/img/mc2.webp)" class="imgbox" onclick="changeBg('url(https://sourcebucket.s3.bitiful.net/img/mc2.webp)')"></a><a href="javascript:;" rel="noopener external nofollow" style="background-image:url(https://sourcebucket.s3.bitiful.net/img/mc3.webp)" class="imgbox" onclick="changeBg('url(https://sourcebucket.s3.bitiful.net/img/mc3.webp)')"></a><a href="javascript:;" rel="noopener external nofollow" style="background-image:url(https://sourcebucket.s3.bitiful.net/img/mc4.webp)" class="imgbox" onclick="changeBg('url(https://sourcebucket.s3.bitiful.net/img/mc4.webp)')"></a><a href="javascript:;" rel="noopener external nofollow" style="background-image:url(https://sourcebucket.s3.bitiful.net/img/mc5.webp)" class="imgbox" onclick="changeBg('url(https://sourcebucket.s3.bitiful.net/img/mc5.webp)')"></a><a href="javascript:;" rel="noopener external nofollow" style="background-image:url(https://sourcebucket.s3.bitiful.net/img/mc6.webp)" class="imgbox" onclick="changeBg('url(https://sourcebucket.s3.bitiful.net/img/mc6.webp)')"></a><a href="javascript:;" rel="noopener external nofollow" style="background-image:url(https://sourcebucket.s3.bitiful.net/img/mc7.webp)" class="imgbox" onclick="changeBg('url(https://sourcebucket.s3.bitiful.net/img/mc7.webp)')"></a><a href="javascript:;" rel="noopener external nofollow" style="background-image:url(https://sourcebucket.s3.bitiful.net/img/mc8.webp)" class="imgbox" onclick="changeBg('url(https://sourcebucket.s3.bitiful.net/img/mc8.webp)')"></a></div>\n              </div>\n            </details>\n\n

<h3>4. æ¸å˜è‰²</h3>

\n<details class="folding-tag" cyan><summary> æŸ¥çœ‹æ¸å˜è‰²èƒŒæ™¯ </summary>\n              <div class='content'>\n              <div class="bgbox"><a href="javascript:;" rel="noopener external nofollow" class="box" style="background: linear-gradient(to right, #544a7d, #ffd452)" onclick="changeBg('linear-gradient(to right, #544a7d, #ffd452)')"></a><a href="javascript:;" rel="noopener external nofollow" class="box" style="background: linear-gradient(to bottom, #7f7fd5, #86a8e7, #91eae4)" onclick="changeBg('linear-gradient(to bottom, #7f7fd5, #86a8e7, #91eae4)')"></a><a href="javascript:;" rel="noopener external nofollow" class="box" style="background: linear-gradient(to left, #654ea3, #eaafc8)" onclick="changeBg('linear-gradient(to left, #654ea3, #eaafc8)')"></a><a href="javascript:;" rel="noopener external nofollow" class="box" style="background: linear-gradient(to top, #feac5e, #c779d0, #4bc0c8)" onclick="changeBg('linear-gradient(to top, #feac5e, #c779d0, #4bc0c8)')"></a><a href="javascript:;" rel="noopener external nofollow" class="box" style="background: linear-gradient(to top, #d3959b, #bfe6ba)" onclick="changeBg('linear-gradient(to top, #d3959b, #bfe6ba)')"></a><a href="javascript:;" rel="noopener external nofollow" class="box" style="background: linear-gradient(to top, #8360c3, #2ebf91)" onclick="changeBg('linear-gradient(to top, #8360c3, #2ebf91)')"></a><a href="javascript:;" rel="noopener external nofollow" class="box" style="background: linear-gradient(to top, #108dc7, #ef8e38)" onclick="changeBg('linear-gradient(to top, #108dc7, #ef8e38)')"></a><a href="javascript:;" rel="noopener external nofollow" class="box" style="background: linear-gradient(to top, #355c7d, #6c5b7b, #c06c84)" onclick="changeBg('linear-gradient(to top, #355c7d, #6c5b7b, #c06c84)')"></a></div>\n              </div>\n            </details>\n\n\n

<h3>5. çº¯è‰²</h3>

\n<details class="folding-tag" cyan><summary> æŸ¥çœ‹çº¯è‰²èƒŒæ™¯ </summary>\n              <div class='content'>\n              <div class="bgbox"><a href="javascript:;" rel="noopener external nofollow" class="box" style="background: #ecb1b1" onclick="changeBg('#ecb1b1')"></a> <a href="javascript:;" rel="noopener external nofollow" class="box" style="background: #d3ebac" onclick="changeBg('#d3ebac')"></a> <a href="javascript:;" rel="noopener external nofollow" class="box" style="background: #ace9ce" onclick="changeBg('#ace9ce')"></a><a href="javascript:;" rel="noopener external nofollow" class="box" style="background: #c1ebea" onclick="changeBg('#c1ebea')"></a> <a href="javascript:;" rel="noopener external nofollow" class="box" style="background: #dee7f1" onclick="changeBg('#dee7f1')"></a> <a href="javascript:;" rel="noopener external nofollow" class="box" style="background: #e9e3f2" onclick="changeBg('#e9e3f2')"></a> <a href="javascript:;" rel="noopener external nofollow" class="box" style="background: #f7eff5" onclick="changeBg('#f7eff5')"></a>  <input type="color" id="define_colors" href="javascript:;" rel="noopener external nofollow" class="box" autocomplete="on" value="${defineColor}" oninput="changeBgColor()"></input></div>\n              </div>\n            </details>\n\n\n\n

<h3>6. é€‚é…æ‰‹æœº</h3>

\n<details class="folding-tag" cyan><summary> æŸ¥çœ‹é€‚é…æ‰‹æœºçš„èƒŒæ™¯ </summary>\n              <div class='content'>\n              <div class="bgbox"><a href="javascript:;" rel="noopener external nofollow" style="background-image:url(https://sourcebucket.s3.bitiful.net/img/mb4.webp)" class="pimgbox" onclick="changeBg('url(https://sourcebucket.s3.bitiful.net/img/mb4.webp)')"></a><a href="javascript:;" rel="noopener external nofollow" style="background-image:url(https://sourcebucket.s3.bitiful.net/img/mb5.webp)" class="pimgbox" onclick="changeBg('url(https://sourcebucket.s3.bitiful.net/img/mb5.webp)')"></a><a href="javascript:;" rel="noopener external nofollow" style="background-image:url(https://sourcebucket.s3.bitiful.net/img/mb6.webp)" class="pimgbox" onclick="changeBg('url(https://sourcebucket.s3.bitiful.net/img/mb6.webp)')"></a><a href="javascript:;" rel="noopener external nofollow" style="background-image:url(https://sourcebucket.s3.bitiful.net/img/mb7.webp)" class="pimgbox" onclick="changeBg('url(https://sourcebucket.s3.bitiful.net/img/mb7.webp)')"></a><a href="javascript:;" rel="noopener external nofollow" style="background-image:url(https://sourcebucket.s3.bitiful.net/img/mb8.webp)" class="pimgbox" onclick="changeBg('url(https://sourcebucket.s3.bitiful.net/img/mb8.webp)')"></a><a href="javascript:;" rel="noopener external nofollow" style="background-image:url(https://sourcebucket.s3.bitiful.net/img/mb9.webp)" class="pimgbox" onclick="changeBg('url(https://sourcebucket.s3.bitiful.net/img/mb9.webp)')"></a><a href="javascript:;" rel="noopener external nofollow" style="background-image:url(https://sourcebucket.s3.bitiful.net/img/mb16.webp)" class="pimgbox" onclick="changeBg('url(https://sourcebucket.s3.bitiful.net/img/mb16.webp)')"></a><a href="javascript:;" rel="noopener external nofollow" style="background-image:url(https://sourcebucket.s3.bitiful.net/img/mb19.webp)" class="pimgbox" onclick="changeBg('url(https://sourcebucket.s3.bitiful.net/img/mb19.webp)')"></a></div>\n              </div>\n            </details>\n\n\n

<h3>7. è‡ªå®šä¹‰èƒŒæ™¯</h3>

\n<details class="folding-tag" cyan><summary> è®¾ç½®è‡ªå®šä¹‰èƒŒæ™¯ </summary>\n              <div class='content'>\n              <p><center><input type="text" id="pic-link" size="70%" maxlength="1000" placeholder="è¯·è¾“å…¥æœ‰æ•ˆçš„å›¾ç‰‡é“¾æ¥ï¼Œå¦‚ https://source.fomal.cc/img/home_bg.webp"></center></p><p><center><button class="winbox_btn" type="button" onclick="getPicture()" style="background:var(--theme-color);width:35%;padding: 5px 0px 7px 0px;border-radius:30px;color:white;line-height:2;">ğŸŒˆåˆ‡æ¢èƒŒæ™¯ğŸŒˆ</button></center></p>\n              </div>\n            </details>\n\n

`;

  // æ‰“å¼€å°çª—æ—¶å€™åˆå§‹åŒ–
  $("#" + localStorage.getItem("themeColor")).attr("checked", true);
  if (localStorage.getItem("blur") == 1) {
    document.getElementById("blur").checked = true;
  } else {
    document.getElementById("blur").checked = false;
  }
  if (localStorage.getItem("universe") == "block") {
    document.getElementById("universeSet").checked = true;
  } else if (localStorage.getItem("universe") == "none") {
    document.getElementById("universeSet").checked = false;
  }
  if (localStorage.getItem("fpson") == "1") {
    document.getElementById("fpson").checked = true;
  } else {
    document.getElementById("fpson").checked = false;
  }
  if (localStorage.getItem("rs") == "block") {
    document.getElementById("rightSideSet").checked = true;
  } else if (localStorage.getItem("rs") == "none") {
    document.getElementById("rightSideSet").checked = false;
  }
  if (localStorage.getItem("light") == "true") {
    document.getElementById("lightSet").checked = true;
  } else {
    document.getElementById("lightSet").checked = false;
  }
  setFontBorder();
  if (localStorage.getItem("snow") == "block") {
    document.getElementById("snowSet").checked = true;
  } else if (localStorage.getItem("snow") == "none") {
    document.getElementById("snowSet").checked = false;
  }
}

// æ¢å¤é»˜è®¤èƒŒæ™¯
function resetBg() {
  localStorage.removeItem("blogbg");
  reload();
}

// æ¢å¤é»˜è®¤è®¾ç½®å¹¶åˆ·æ–°é¡µé¢
function reset() {
  clearItem();
  reload();
}

// é€‚åº”çª—å£å¤§å°
function winResize() {
  try {
    var offsetWid = document.documentElement.clientWidth;
    if (offsetWid <= 768) {
      winbox.resize(offsetWid * 0.95 + "px", "90%").move("center", "center");
    } else {
      winbox.resize(offsetWid * 0.6 + "px", "70%").move("center", "center");
    }
  } catch (err) {
    // console.log("Pjaxæ¯’ç˜¤æŠ½é£è¿è¡ŒwinResizeæ–¹æ³•ğŸ™„ğŸ™„ğŸ™„");
  }
}

// åˆ‡æ¢çŠ¶æ€ï¼Œçª—å£å·²åˆ›å»ºåˆ™æ§åˆ¶çª—å£æ˜¾ç¤ºå’Œéšè—ï¼Œæ²¡çª—å£åˆ™åˆ›å»ºçª—å£
function toggleWinbox() {
  if (document.querySelector("#meihuaBox")) {
    winbox.toggleClass("hide");
  } else {
    createWinbox();
  }
}

/* ç¾åŒ–æ¨¡å— end */

// åŠ è½½Twikooåº“
async function loadTwikooLibrary() {
  return new Promise((resolve, reject) => {
    if (window.twikoo) {
      // å¦‚æœ Twikoo åº“å·²ç»åŠ è½½è¿‡ï¼Œåˆ™ç›´æ¥è¿”å›æˆåŠŸçš„ Promise
      resolve();
      return;
    }

    const script = document.createElement("script");
    script.src =
      "https://cdn.jsdelivr.net/npm/twikoo@1.6.44/dist/twikoo.min.js";
    script.onload = () => {
      console.log("Twikooåº“åŠ è½½æˆåŠŸ");
      resolve();
    };
    script.onerror = () => {
      reject(new Error("Twikooåº“åŠ è½½å¤±è´¥"));
    };
    document.head.appendChild(script);
  });
}

// åˆ›å»ºé®ç½©å±‚
function createOverlay() {
  const overlay = document.createElement("div");
  overlay.id = "overlay";
  overlay.classList.add("overlay"); // æ·»åŠ  CSS ç±»
  // æ·»åŠ ç‚¹å‡»ç›‘å¬å™¨ä»¥å…³é—­å¼¹çª—
  document.addEventListener("click", handleClickOutsidePopup);
  return overlay;
}

// åˆ›å»ºå¼¹çª—
function createPopup() {
  const popup = document.createElement("div");
  popup.id = "popup";
  popup.classList.add("popup"); // æ·»åŠ  CSS ç±»
  return popup;
}

// å…³é—­å¼¹çª—å¹¶ç§»é™¤é®ç½©å±‚
function closePopup(popup, overlay) {
  // éšè—é®ç½©å±‚å’Œå¼¹çª—çš„åŠ¨ç”»
  overlay.style.opacity = 0;
  popup.style.opacity = 0;

  // åœ¨åŠ¨ç”»ç»“æŸåç§»é™¤å…ƒç´ 
  setTimeout(() => {
    document.body.removeChild(popup);
    document.body.removeChild(overlay);
    document.removeEventListener("click", handleClickOutsidePopup);
  }, 300); // åŠ¨ç”»æŒç»­æ—¶é—´ä¸ transition æŒç»­æ—¶é—´ä¸€è‡´
}

// ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­å¼¹çª—
function handleClickOutsidePopup(event) {
  const popup = document.getElementById("popup");
  if (popup && !popup.contains(event.target)) {
    closePopup(popup, document.getElementById("overlay"));
  }
}

// é€šç”¨å‡½æ•°ï¼šæ˜¾ç¤ºæç¤ºæ¶ˆæ¯
function showMessage(message, duration = 2000) {
  // åˆ›å»ºæç¤ºæ¶ˆæ¯å…ƒç´ 
  const replySelectMessage = document.createElement("div");
  replySelectMessage.innerHTML = message;
  replySelectMessage.classList.add("pop-message"); // æ·»åŠ  CSS ç±»
  document.body.appendChild(replySelectMessage);

  // è®¾ç½®åˆå§‹é€æ˜åº¦ä¸º0
  replySelectMessage.style.opacity = "0";

  // ä½¿ç”¨ setTimeout è®¾ç½®åŠ¨ç”»æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
  setTimeout(() => {
    replySelectMessage.style.opacity = "1";
  }, 10);

  // å®šä¹‰ç§»é™¤æç¤ºæ¶ˆæ¯çš„å‡½æ•°
  function removeMessage() {
    // å°†é€æ˜åº¦è®¾ç½®ä¸º0ï¼Œä½¿å…¶éšè—
    replySelectMessage.style.opacity = "0";

    // ç­‰å¾…éšè—åŠ¨ç”»å®Œæˆåç§»é™¤å…ƒç´ 
    setTimeout(() => {
      document.body.removeChild(replySelectMessage);
    }, 500); // åŠ¨ç”»æŒç»­æ—¶é—´
  }

  // æ ¹æ®æŒ‡å®šçš„æŒç»­æ—¶é—´è®¾ç½®å®šæ—¶å™¨æ¥ç§»é™¤æç¤ºæ¶ˆæ¯
  setTimeout(removeMessage, duration);
}

// æ˜¾ç¤ºå¸¦è¯„è®ºçš„å¼¹çª—
function showPopupWithComments(envId, commentElementId) {
  // åˆ›å»ºé®ç½©å±‚
  const overlay = createOverlay();

  // åˆ›å»ºå¼¹çª—
  const popup = createPopup();

  // æ·»åŠ è¯„è®ºéƒ¨åˆ†
  const commentSection = document.createElement("div");
  commentSection.id = commentElementId;
  popup.appendChild(commentSection);

  // å°†å¼¹çª—å’Œé®ç½©æ·»åŠ åˆ°æ–‡æ¡£ä¸­
  document.body.appendChild(overlay);
  document.body.appendChild(popup);

  // åˆå§‹åŒ– Twikoo
  twikoo.init({ envId, el: `#${commentElementId}` });

  // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯å¹¶åœ¨ 2 ç§’åç§»é™¤
  showMessage("ç‚¹å‡»å¼¹çª—å¤–ä»»æ„éƒ¨åˆ†å³å¯é€€å‡º");

  // æ˜¾ç¤ºé®ç½©å±‚å’Œå¼¹çª—çš„åŠ¨ç”»
  setTimeout(() => {
    overlay.style.opacity = 1;
    popup.style.opacity = 1;
  }, 0);
}

// ä½¿ç”¨å¼‚æ­¥/awaitç¡®ä¿Twikooåº“åŠ è½½å®Œæˆåæ‰§è¡Œæ“ä½œ
async function replySelect() {
  rmf.showRightMenu(false);
  var selectedText = document.getSelection().toString().trim();

  if (selectedText.includes("\n")) {
    selectedText = selectedText.split("\n")[0].trim();
  }

  try {
    // ç­‰å¾…Twikooåº“åŠ è½½å®Œæˆ
    await loadTwikooLibrary();
    // æ˜¾ç¤ºå¸¦è¯„è®ºçš„å¼¹çª—
    showPopupWithComments("https://twikoo.002026.xyz/", "comment-section");
  } catch (error) {
    console.error(error);
  }

  const commentBox = document.querySelector("#popup .el-textarea__inner");
  commentBox.value = `> ${selectedText}\n\n`;
}

// å°† replySelect å‡½æ•°ç»‘å®šåˆ°ç‰¹å®šäº‹ä»¶æˆ–å¯¹è±¡
var rm = {};
rm.replySelect = replySelect;
